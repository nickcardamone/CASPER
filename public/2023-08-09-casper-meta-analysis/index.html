<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <meta name="generator" content="Hugo 0.117.0">
  <link rel="canonical" href="https://example.com/2023-08-09-casper-meta-analysis/" />

  
    
    <meta name="description" content="DistillerSR options: Advanced Options: Hide Empty Columns, Merge Sets by Key, Compress checkboxes to one column, “Merge Data and duplicate single forms to repeating forms”, Data criteria: user = cardamone, Reference display options: display author and title Report settings: limit to label = “RCT” &amp; NOT “throwaway” “study char”: Study char &#43; determinants &#43; outcomes “icc_cov”: Source &#43; Covariate R-Sq “sample_size”: Source &#43; Conditions “effect_size”: Source &#43; Effect Size Only keep entries filled in by Nick # Remove irrelevant variables: e.">
  

  <link rel="apple-touch-icon" sizes="180x180" href="https://example.com/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://example.com/favicon-32x32.png"> 
  <link rel="icon" type="image/png" sizes="16x16" href="https://example.com/favicon-16x16.png"> 
  <link rel="manifest" href="https://example.com/site.webmanifest"> 
  <link rel="mask-icon" href="https://example.com/safari-pinned-tab.svg" color="#000000"> 
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">

  <style>
    body {
      visibility: hidden;
      opacity: 0;
    }
  </style>

  <style id="darkTheme">
    .intro-and-nav,
    .main-and-footer {
      filter: invert(100%);
    }

    * {
      background-color: inherit
    }

    img:not([src*=".svg"]),
    .colors,
    iframe,
    .demo-container {
      filter: invert(100%);
    }
  </style>

  <link rel="stylesheet" href="/css/prism.css" media="none" onload="this.media='all';">

  
  
  <link rel="stylesheet" type="text/css" href="/css/styles.css">

  
    <link rel="stylesheet" href="/css/custom_01.css">
  
    <link rel="stylesheet" href="/css/custom_02.css">
  

  
  
  <title>CASPER Meta-Analysis Documentation | Project CASPER</title>
</head>

  <body>
    <a href="#main">skip to content</a>
    <noscript>
  <style>
    body {
      visibility: visible;
      opacity: 1;
    }
  </style>
</noscript>

    <svg style="display: none">
  <symbol id="bookmark" viewBox="0 0 40 50">
   <g transform="translate(2266 3206.2)">
    <path style="stroke:currentColor;stroke-width:3.2637;fill:none" d="m-2262.2-3203.4-.2331 42.195 16.319-16.318 16.318 16.318.2331-42.428z"/>
   </g>
  </symbol>

  <symbol id="w3c" viewBox="0 0 127.09899 67.763">
   <text font-size="83" style="font-size:83px;font-family:Trebuchet;letter-spacing:-12;fill-opacity:0" letter-spacing="-12" y="67.609352" x="-26.782778">W3C</text>
   <text font-size="83" style="font-size:83px;font-weight:bold;font-family:Trebuchet;fill-opacity:0" y="67.609352" x="153.21722" font-weight="bold">SVG</text>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m33.695.377 12.062 41.016 12.067-41.016h8.731l-19.968 67.386h-.831l-12.48-41.759-12.479 41.759h-.832l-19.965-67.386h8.736l12.061 41.016 8.154-27.618-3.993-13.397h8.737z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m91.355 46.132c0 6.104-1.624 11.234-4.862 15.394-3.248 4.158-7.45 6.237-12.607 6.237-3.882 0-7.263-1.238-10.148-3.702-2.885-2.47-5.02-5.812-6.406-10.022l6.82-2.829c1.001 2.552 2.317 4.562 3.953 6.028 1.636 1.469 3.56 2.207 5.781 2.207 2.329 0 4.3-1.306 5.909-3.911 1.609-2.606 2.411-5.738 2.411-9.401 0-4.049-.861-7.179-2.582-9.399-1.995-2.604-5.129-3.912-9.397-3.912h-3.327v-3.991l11.646-20.133h-14.062l-3.911 6.655h-2.493v-14.976h32.441v4.075l-12.31 21.217c4.324 1.385 7.596 3.911 9.815 7.571 2.22 3.659 3.329 7.953 3.329 12.892z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.21 0 1.414 8.6-5.008 9.583s-1.924-4.064-5.117-6.314c-2.693-1.899-4.447-2.309-7.186-1.746-3.527.73-7.516 4.938-9.258 10.13-2.084 6.21-2.104 9.218-2.178 11.978-.115 4.428.58 7.043.58 7.043s-3.04-5.626-3.011-13.866c.018-5.882.947-11.218 3.666-16.479 2.404-4.627 5.954-7.404 9.114-7.728 3.264-.343 5.848 1.229 7.841 2.938 2.089 1.788 4.213 5.698 4.213 5.698l4.94-9.837z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.82 48.674s-2.208 3.957-3.589 5.48c-1.379 1.524-3.849 4.209-6.896 5.555-3.049 1.343-4.646 1.598-7.661 1.306-3.01-.29-5.807-2.032-6.786-2.764-.979-.722-3.486-2.864-4.897-4.854-1.42-2-3.634-5.995-3.634-5.995s1.233 4.001 2.007 5.699c.442.977 1.81 3.965 3.749 6.572 1.805 2.425 5.315 6.604 10.652 7.545 5.336.945 9.002-1.449 9.907-2.031.907-.578 2.819-2.178 4.032-3.475 1.264-1.351 2.459-3.079 3.116-4.108.487-.758 1.276-2.286 1.276-2.286l-1.276-6.644z"/>
  </symbol>

  <symbol id="tag" viewBox="0 0 177.16535 177.16535">
    <g transform="translate(0 -875.2)">
     <path style="fill-rule:evenodd;stroke-width:0;fill:currentColor" d="m159.9 894.3-68.79 8.5872-75.42 77.336 61.931 60.397 75.429-76.565 6.8495-69.755zm-31.412 31.835a10.813 10.813 0 0 1 1.8443 2.247 10.813 10.813 0 0 1 -3.5174 14.872l-.0445.0275a10.813 10.813 0 0 1 -14.86 -3.5714 10.813 10.813 0 0 1 3.5563 -14.863 10.813 10.813 0 0 1 13.022 1.2884z"/>
    </g>
  </symbol>

  <symbol id="balloon" viewBox="0 0 141.73228 177.16535">
   <g transform="translate(0 -875.2)">
    <g>
     <path style="fill:currentColor" d="m68.156 882.83-.88753 1.4269c-4.9564 7.9666-6.3764 17.321-5.6731 37.378.36584 10.437 1.1246 23.51 1.6874 29.062.38895 3.8372 3.8278 32.454 4.6105 38.459 4.6694-.24176 9.2946.2879 14.377 1.481 1.2359-3.2937 5.2496-13.088 8.886-21.623 6.249-14.668 8.4128-21.264 10.253-31.252 1.2464-6.7626 1.6341-12.156 1.4204-19.764-.36325-12.93-2.1234-19.487-6.9377-25.843-2.0833-2.7507-6.9865-7.6112-7.9127-7.8436-.79716-.20019-6.6946-1.0922-6.7755-1.0248-.02213.0182-5.0006-.41858-7.5248-.22808l-2.149-.22808h-3.3738z"/>
     <path style="fill:currentColor" d="m61.915 883.28-3.2484.4497c-1.7863.24724-3.5182.53481-3.8494.63994-2.4751.33811-4.7267.86957-6.7777 1.5696-.28598 0-1.0254.20146-2.3695.58589-5.0418 1.4418-6.6374 2.2604-8.2567 4.2364-6.281 7.6657-11.457 18.43-12.932 26.891-1.4667 8.4111.71353 22.583 5.0764 32.996 3.8064 9.0852 13.569 25.149 22.801 37.517 1.3741 1.841 2.1708 2.9286 2.4712 3.5792 3.5437-1.1699 6.8496-1.9336 10.082-2.3263-1.3569-5.7831-4.6968-21.86-6.8361-33.002-.92884-4.8368-2.4692-14.322-3.2452-19.991-.68557-5.0083-.77707-6.9534-.74159-15.791.04316-10.803.41822-16.162 1.5026-21.503 1.4593-5.9026 3.3494-11.077 6.3247-15.852z"/>
     <path style="fill:currentColor" d="m94.499 885.78c-.10214-.0109-.13691 0-.0907.0409.16033.13489 1.329 1.0675 2.5976 2.0723 6.7003 5.307 11.273 14.568 12.658 25.638.52519 4.1949.24765 14.361-.5059 18.523-2.4775 13.684-9.7807 32.345-20.944 53.519l-3.0559 5.7971c2.8082.76579 5.7915 1.727 8.9926 2.8441 11.562-11.691 18.349-19.678 24.129-28.394 7.8992-11.913 11.132-20.234 12.24-31.518.98442-10.02-1.5579-20.876-6.7799-28.959-.2758-.4269-.57803-.86856-.89617-1.3166-3.247-6.13-9.752-12.053-21.264-16.131-2.3687-.86369-6.3657-2.0433-7.0802-2.1166z"/>
     <path style="fill:currentColor" d="m32.52 892.22c-.20090-.13016-1.4606.81389-3.9132 2.7457-11.486 9.0476-17.632 24.186-16.078 39.61.79699 7.9138 2.4066 13.505 5.9184 20.562 5.8577 11.77 14.749 23.219 30.087 38.74.05838.059.12188.1244.18052.1838 1.3166-.5556 2.5965-1.0618 3.8429-1.5199-.66408-.32448-1.4608-1.3297-3.8116-4.4602-5.0951-6.785-8.7512-11.962-13.051-18.486-5.1379-7.7948-5.0097-7.5894-8.0586-13.054-6.2097-11.13-8.2674-17.725-8.6014-27.563-.21552-6.3494.13041-9.2733 1.775-14.987 2.1832-7.5849 3.9273-10.986 9.2693-18.07 1.7839-2.3656 2.6418-3.57 2.4409-3.7003z"/>
     <path style="fill:currentColor" d="m69.133 992.37c-6.2405.0309-12.635.76718-19.554 2.5706 4.6956 4.7759 9.935 10.258 12.05 12.625l4.1272 4.6202h11.493l3.964-4.4516c2.0962-2.3541 7.4804-7.9845 12.201-12.768-8.378-1.4975-16.207-2.6353-24.281-2.5955z"/>
     <rect style="stroke-width:0;fill:currentColor" ry="2.0328" height="27.746" width="22.766" y="1017.7" x="60.201"/>
    </g>
   </g>
  </symbol>

  <symbol id="info" viewBox="0 0 41.667 41.667">
   <g transform="translate(-37.035 -1004.6)">
    <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m76.25 1030.2a18.968 18.968 0 0 1 -23.037 13.709 18.968 18.968 0 0 1 -13.738 -23.019 18.968 18.968 0 0 1 23.001 -13.768 18.968 18.968 0 0 1 13.798 22.984"/>
    <g transform="matrix(1.1146 0 0 1.1146 -26.276 -124.92)">
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m75.491 1039.5v-8.7472"/>
     <path style="stroke-width:0;fill:currentColor" transform="scale(-1)" d="m-73.193-1024.5a2.3719 2.3719 0 0 1 -2.8807 1.7142 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
   </g>
  </symbol>

  <symbol id="warning" viewBox="0 0 48.430474 41.646302">
    <g transform="translate(-1.1273 -1010.2)">
     <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:4.151;fill:none" d="m25.343 1012.3-22.14 37.496h44.28z"/>
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:4.1512;fill:none" d="m25.54 1027.7v8.7472"/>
     <path style="stroke-width:0;fill:currentColor" d="m27.839 1042.8a2.3719 2.3719 0 0 1 -2.8807 1.7143 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
  </symbol>

  <symbol id="menu" viewBox="0 0 50 50">
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="0" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="20" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="40" x="0"/>
   </symbol>

   <symbol id="link" viewBox="0 0 50 50">
    <g transform="translate(0 -1002.4)">
     <g transform="matrix(.095670 0 0 .095670 2.3233 1004.9)">
      <g>
       <path style="stroke-width:0;fill:currentColor" d="m452.84 192.9-128.65 128.65c-35.535 35.54-93.108 35.54-128.65 0l-42.881-42.886 42.881-42.876 42.884 42.876c11.845 11.822 31.064 11.846 42.886 0l128.64-128.64c11.816-11.831 11.816-31.066 0-42.9l-42.881-42.881c-11.822-11.814-31.064-11.814-42.887 0l-45.928 45.936c-21.292-12.531-45.491-17.905-69.449-16.291l72.501-72.526c35.535-35.521 93.136-35.521 128.64 0l42.886 42.881c35.535 35.523 35.535 93.141-.001 128.66zm-254.28 168.51-45.903 45.9c-11.845 11.846-31.064 11.817-42.881 0l-42.884-42.881c-11.845-11.821-11.845-31.041 0-42.886l128.65-128.65c11.819-11.814 31.069-11.814 42.884 0l42.886 42.886 42.876-42.886-42.876-42.881c-35.54-35.521-93.113-35.521-128.65 0l-128.65 128.64c-35.538 35.545-35.538 93.146 0 128.65l42.883 42.882c35.51 35.54 93.11 35.54 128.65 0l72.496-72.499c-23.956 1.597-48.092-3.784-69.474-16.283z"/>
      </g>
     </g>
    </g>
  </symbol>

  <symbol id="doc" viewBox="0 0 35 45">
   <g transform="translate(-147.53 -539.83)">
    <path style="stroke:currentColor;stroke-width:2.4501;fill:none" d="m149.38 542.67v39.194h31.354v-39.194z"/>
    <g style="stroke-width:25" transform="matrix(.098003 0 0 .098003 133.69 525.96)">
     <path d="m220 252.36h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path style="stroke:currentColor;stroke-width:25;fill:none" d="m220 409.95h200"/>
     <path d="m220 488.74h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path d="m220 331.15h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
    </g>
   </g>
 </symbol>

 <symbol id="tick" viewBox="0 0 177.16535 177.16535">
  <g transform="translate(0 -875.2)">
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="155" width="40" y="702.99" x="556.82"/>
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="40" width="90.404" y="817.99" x="506.42"/>
  </g>
 </symbol>
</svg>

    <div class="wrapper">
      <header class="intro-and-nav" role="banner">
  <div>
    <div class="intro">
      <a
        class="logo"
        href="https://example.com"
        aria-label="Project CASPER home page"
      >
        
          <img 
            src="/images/logo.svg" 
            alt="CASPER the ghost"
          >
        
      </a>
      <p class="library-desc">
         Welcome to the documentation site for Project CASPER! 
      </p>
    </div>
    <nav id="patterns-nav" class="patterns" role="navigation">
  <h2 class="vh">Main navigation</h2>
  <button id="menu-button" aria-expanded="false">
    <svg viewBox="0 0 50 50" aria-hidden="true" focusable="false">
      <use href="#menu"></use>
    </svg>
    Menu
  </button>
  
  <ul id="patterns-list">
  
    <li class="pattern">
      
      
      
      
      <a href="/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">Home</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/post/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">Documentation</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/tags/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">Tags</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/about/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">About</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/index.xml" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">RSS</span>
      </a>
    </li>
  
  </ul>
</nav>
    
  </div>
</header>

      <div class="main-and-footer">
        <div>
          
  <main id="main">
    <h1>
      <svg class="bookmark-icon" aria-hidden="true" viewBox="0 0 40 50" focusable="false">
        <use href="#bookmark"></use>
      </svg>
      CASPER Meta-Analysis Documentation
    </h1>

    <div class="date">
      
      
      <strong>Publish date: </strong>Aug 9, 2023
      
        
          <br>
          <strong>Last updated: </strong>Aug 9, 2023
        
      
    </div>

    
      <div class="tags">
        <strong>Tags: </strong>
        <ul aria-label="tags">
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use href="#tag"></use>
              </svg>
              
              <a href="/tags/r-markdown/">R Markdown</a>
            </li>
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use href="#tag"></use>
              </svg>
              
              <a href="/tags/meta-analysis/">meta analysis</a>
            </li>
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use href="#tag"></use>
              </svg>
              
              <a href="/tags/implementation-science/">implementation science</a>
            </li>
          
        </ul>
      </div>
    

    


    <h3 id="distillersr-options">DistillerSR options:</h3>
<ul>
<li>Advanced Options: Hide Empty Columns, Merge Sets by Key, Compress checkboxes to one column, &ldquo;Merge Data and duplicate single forms to repeating forms&rdquo;,</li>
<li>Data criteria: user = cardamone,</li>
<li>Reference display options: display author and title</li>
<li>Report settings: limit to label = &ldquo;RCT&rdquo; &amp; NOT &ldquo;throwaway&rdquo;</li>
<li>&ldquo;study char&rdquo;: Study char + determinants + outcomes</li>
<li>&ldquo;icc_cov&rdquo;: Source + Covariate R-Sq</li>
<li>&ldquo;sample_size&rdquo;: Source + Conditions</li>
<li>&ldquo;effect_size&rdquo;: Source + Effect Size</li>
</ul>
<h3 id="only-keep-entries-filled-in-by-nick">Only keep entries filled in by Nick</h3>
<pre><code class="language-r"># Remove irrelevant variables: e.g. all notes, comments, info: also collapse the analysis type variable. 
study_characteristics &lt;- study_characteristics %&gt;% filter(str_detect(Characteristics_k, &quot;Nick&quot;) == T) %&gt;% select(-ends_with(&quot;notes&quot;), -ends_with(&quot;comment&quot;), -ends_with(&quot;info&quot;), -Level, -User)
sample_size &lt;- sample_size %&gt;% filter(str_detect(Source_k, &quot;Nick&quot;) == T) %&gt;% select(-ends_with(&quot;notes&quot;), -ends_with(&quot;comment&quot;), -ends_with(&quot;info&quot;), -Level, -User)
icc_cov &lt;- icc_cov %&gt;% filter(str_detect(Source_k, &quot;Nick&quot;) == T) %&gt;% select(-ends_with(&quot;notes&quot;), -ends_with(&quot;comment&quot;), -ends_with(&quot;info&quot;), -Level, -User) %&gt;% tidyr::unite(&quot;analysis_type&quot;, c(analysis_type, measure_type_ep), sep= &quot;_&quot;, remove = T, na.rm = T)
effect_size &lt;- effect_size %&gt;% filter(str_detect(Source_k, &quot;Nick&quot;) == T) %&gt;% select(-ends_with(&quot;notes&quot;), -ends_with(&quot;comment&quot;), -ends_with(&quot;info&quot;)) %&gt;% tidyr::unite(&quot;analysis_type&quot;, c(analysis_type, measure_type_ep), sep= &quot;_&quot;, remove = T, na.rm = T)
</code></pre>
<pre><code class="language-r"># Make the number of time points a numeric variable -- if it's not a longitudinal study just change the number of time points to 1.
effect_size &lt;- effect_size %&gt;% mutate(
         num_timepoints = if_else(!is.na(num_timepoints_standard), as.numeric(num_timepoints_standard), 
                                  if_else(!is.na(num_timepoints_nonstandard), as.numeric(num_timepoints_nonstandard), 
                                          if_else(analysis_type != &quot;long&quot;, 1, NA)))) %&gt;% select(-measure_type_long, -num_timepoints_standard, -num_timepoints_nonstandard, -Level, -User, -cov_applicable)


# Remove &quot;NR&quot;
study_characteristics[study_characteristics == &quot;NR&quot;] &lt;- NA
sample_size[sample_size == &quot;NR&quot;] &lt;- NA
icc_cov[icc_cov == &quot;NR&quot;] &lt;- NA
effect_size[effect_size == &quot;NR&quot;] &lt;- NA
</code></pre>
<h3 id="study-characteristics">Study Characteristics</h3>
<ul>
<li>Outcomes</li>
<li>Implementation Strategies</li>
<li>Study Metadata</li>
</ul>
<pre><code class="language-r">outcomes &lt;- study_characteristics %&gt;% select(Refid, Outcomes_k, dv_name, dv_outcome, dv_measure_approach)
# We're only taking variables at the study level for the implementation strategies and metadata datasets so

imp_strategies &lt;- study_characteristics %&gt;% select(Refid, IVs_k, imp1_name:control_target) %&gt;% distinct() 
metadata &lt;- study_characteristics %&gt;% select(Refid:imps_rand_1) %&gt;% distinct() 

#Make dummy variables for randomization level

metadata$rand_L1 &lt;- if_else(str_detect(as.character(metadata$imps_rand_1), &quot;1&quot;), 1, 0)
metadata$rand_L2 &lt;- if_else(str_detect(as.character(metadata$imps_rand_1), &quot;2&quot;), 1, 0)
metadata$rand_L3 &lt;- if_else(str_detect(as.character(metadata$imps_rand_1), &quot;3&quot;), 1, 0)
metadata$rand_L4 &lt;- if_else(str_detect(as.character(metadata$imps_rand_1), &quot;4&quot;), 1, 0)
</code></pre>
<pre><code class="language-r"># Pivot longer so that 1 row = 1 condition (nested within studies.)
names &lt;- imp_strategies %&gt;% pivot_longer(cols = c(&quot;imp1_name&quot;, &quot;imp2_name&quot;,&quot;imp3_name&quot;, &quot;control_name&quot;), names_to = &quot;comparator&quot;, values_to = &quot;name&quot;, names_pattern = &quot;(.*)_name&quot;) %&gt;% select(Refid, IVs_k, comparator, name)
eric &lt;- imp_strategies %&gt;% pivot_longer(cols = ends_with(&quot;eric&quot;), names_to = &quot;comparator&quot;, values_to = &quot;strategies&quot;, names_pattern = &quot;(.*)_eric&quot;) %&gt;% select(Refid, comparator, strategies)
target &lt;- imp_strategies %&gt;% pivot_longer(cols = c(&quot;imp1_target&quot;, &quot;imp2_target&quot;,&quot;imp3_target&quot;, &quot;control_target&quot;), names_to = &quot;comparator&quot;, values_to = &quot;target&quot;, names_pattern = &quot;(.*)_target&quot;) %&gt;% select(Refid, comparator, target)
</code></pre>
<pre><code class="language-r"># Mash the columns back together to make a tidied dataset for implementation strategies.

imp_strategies &lt;- data.frame(names, eric = eric$strategies, target = target$target)

imp_strategies &lt;- imp_strategies %&gt;% filter(!is.na(name))

imp_strategies$cond_num &lt;- ave(imp_strategies$comparator, imp_strategies$Refid, FUN = seq_along)
imp_strategies$target &lt;- str_to_lower(imp_strategies$target)

imp_strategies &lt;- imp_strategies %&gt;% separate(target, into = c(&quot;target1&quot;, &quot;target2&quot;), sep = &quot;,&quot;)
## Warning: Expected 2 pieces. Additional pieces discarded in 4 rows [9, 10, 17,
## 18].
## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 18 rows [1, 2, 3, 8, 12,
## 13, 14, 21, 22, 24, 25, 26, 27, 30, 31, 33, 36, 38].
imp_strategies &lt;- imp_strategies %&gt;% separate(target1, into = c(&quot;target1&quot;, &quot;target1_detail&quot;), sep = &quot; : &quot;)
## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 29 rows [2, 3, 7, 8, 9,
## 10, 11, 12, 15, 17, 18, 19, 20, 21, 22, 25, 26, 27, 28, 29, ...].
imp_strategies &lt;- imp_strategies %&gt;% separate(target2, into = c(&quot;target2&quot;, &quot;target2_detail&quot;), sep = &quot; : &quot;)
## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 17 rows [5, 6, 7, 9, 10,
## 11, 15, 17, 18, 19, 20, 28, 29, 32, 34, 35, 37].
</code></pre>
<p>** One row per study **</p>
<pre><code class="language-r">imp_strategies_wide &lt;- imp_strategies %&gt;% select(Refid, IVs_k, name, eric, target1, target2, cond_num) %&gt;% pivot_wider(names_from = &quot;cond_num&quot;, values_from = c(&quot;name&quot;, &quot;eric&quot;, &quot;target1&quot;, &quot;target2&quot;))
</code></pre>
<h3 id="sample-size">Sample Size</h3>
<pre><code class="language-r">## Load sample size (Multiple sets of values per DV)
sample_size &lt;- sample_size %&gt;% drop_na(data_source)

#sample_size &lt;- sample_size %&gt;% filter(!is.na(cond_num) &amp; !is.na(data_source))
##### Pivot wider to have unique columns for sample size at each level.

sample_size &lt;- sample_size %&gt;% drop_na(cond_num)
sample_size &lt;- sample_size %&gt;% dplyr::select(Source_k, cond_num, L1_condition_N, L2_condition_N, L3_condition_N, L4_condition_N) #%&gt;% 

# Pivot wider 
sample_size &lt;- reshape(
  merge(sample_size,
        expand.grid(
          Source_k = unique(sample_size$Source_k),
          cond_num = 1:3
        ),
        all = TRUE
  ),
  direction = &quot;wide&quot;,
  idvar = &quot;Source_k&quot;,
  timevar = &quot;cond_num&quot;
)
## Warning in reshapeWide(data, idvar = idvar, timevar = timevar, varying =
## varying, : multiple rows match for cond_num=1: first taken
## Warning in reshapeWide(data, idvar = idvar, timevar = timevar, varying =
## varying, : multiple rows match for cond_num=2: first taken

head(sample_size)
##                                                                                                                                                                       Source_k
## 1                                     Nick-ADHD quality improvement (QI) intervention for community-based pediatric practices|imp_strat_effects|ADHD symptoms (4-levels)|Paper
## 4                                        Nick-ADHD quality improvement (QI) intervention for community-based pediatric practices|imp_strat_effects|ADHD symptoms (4-levels)|PI
## 7                             Nick-ADHD quality improvement (QI) intervention for community-based pediatric practices|imp_strat_effects|Number of contacts in first year|Paper
## 10                               Nick-ADHD quality improvement (QI) intervention for community-based pediatric practices|imp_strat_effects|Number of contacts in first year|PI
## 13  Nick-ADHD quality improvement (QI) intervention for community-based pediatric practices|imp_strat_effects|Number of parent scales to monitor treatment in first year|Paper
## 16 Nick-ADHD quality improvement (QI) intervention for community-based pediatric practices|imp_strat_effects|Number of teacher scales to monitor treatment in first year|Paper
##    L1_condition_N.1 L2_condition_N.1 L3_condition_N.1 L4_condition_N.1
## 1              &lt;NA&gt;              194               63               22
## 4              &lt;NA&gt;              194               63               22
## 7               258               71               22             &lt;NA&gt;
## 10              258               71               22             &lt;NA&gt;
## 13              235               68               22             &lt;NA&gt;
## 16              194               63               22             &lt;NA&gt;
##    L1_condition_N.2 L2_condition_N.2 L3_condition_N.2 L4_condition_N.2
## 1              &lt;NA&gt;              231               76               24
## 4              &lt;NA&gt;              231               76               22
## 7               316               89               23             &lt;NA&gt;
## 10              316               89               23             &lt;NA&gt;
## 13              287               89               24             &lt;NA&gt;
## 16              231               76               24             &lt;NA&gt;
##    L1_condition_N.3 L2_condition_N.3 L3_condition_N.3 L4_condition_N.3
## 1              &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;
## 4              &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;
## 7              &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;
## 10             &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;
## 13             &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;
## 16             &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;
</code></pre>
<h3 id="icc-and-covariate-r-sq">ICC and COVARIATE R-SQ:</h3>
<pre><code class="language-r"># Fix ICC values:
# If L1 variance and L2 variance are in the old L1/L2 variance fields, copy them onto the new fields.
# Drop the + from the &quot;+3&quot; in the num_levels variable so it can be numeric.
# From the PI provided data, just compute the ICC at each level from the VCEs so it's standardized, if it's from the paper leave it alone.
icc_cov &lt;- icc_cov %&gt;% dplyr::mutate(L1_variance_3 = if_else(is.na(L1_variance_3), as.numeric(L1_variance_2), as.numeric(L1_variance_3)),
                                     L2_variance_3 = if_else(is.na(L2_variance_3), as.numeric(L2_variance_2), as.numeric(L2_variance_3)),
                                     num_levels = as.numeric(gsub(&quot;\\+&quot;, &quot;&quot;, `num_levels`)),
                                     ICC_2 = if_else(num_levels == 2 &amp; data_source == &quot;PI&quot;, as.numeric(L2_variance_3)/(as.numeric(L1_variance_3)+as.numeric(L2_variance_3)),
                                                     if_else(num_levels == 3 &amp; data_source == &quot;PI&quot;, as.numeric(L2_variance_3)/(as.numeric(L1_variance_3)+as.numeric(L2_variance_3)+as.numeric(L3_variance_3)),
                                                             if_else(num_levels == 4 &amp; data_source == &quot;PI&quot;, as.numeric(L2_variance_3)/(as.numeric(L1_variance_3)+as.numeric(L2_variance_3)+as.numeric(L3_variance_3)+as.numeric(L4_variance_3)), as.numeric(ICC_2)))),
                                     ICC_3 = if_else(num_levels == 3 &amp; data_source == &quot;PI&quot;, as.numeric(L3_variance_3)/(as.numeric(L1_variance_3)+as.numeric(L2_variance_3)+as.numeric(L3_variance_3)),
                                                     if_else(num_levels == 4 &amp; data_source == &quot;PI&quot;,
                                                             as.numeric(L3_variance_3)/(as.numeric(L1_variance_3)+as.numeric(L2_variance_3)+as.numeric(L3_variance_3)+as.numeric(L4_variance_3)), as.numeric(ICC_3))),
                                     ICC_4 = if_else(num_levels == 4 &amp; data_source == &quot;PI&quot;, as.numeric(L4_variance_3)/(as.numeric(L1_variance_3)+as.numeric(L2_variance_3)+as.numeric(L3_variance_3)+as.numeric(L4_variance_3)),
                                                     as.numeric(ICC_4)))
</code></pre>
<h2 id="covariate-r-squared">Covariate R-squared</h2>
<pre><code class="language-r"># Substitute null model VCE at each level if a value isn't already there.
icc_cov &lt;- icc_cov %&gt;% dplyr::mutate(NULL_VCE = if_else(!is.na(NULL_VCE), as.numeric(NULL_VCE), 
                                                        if_else(level_VCE == 1, as.numeric(L1_variance_3), 
                                                                if_else(level_VCE == 2, as.numeric(L2_variance_3),
                                                                        if_else(level_VCE == 3, as.numeric(L3_variance_3),
                                                                                if_else(level_VCE == 4, as.numeric(L4_variance_3), NA))))))

icc_cov &lt;- icc_cov %&gt;% dplyr::mutate(
  ## 1 - (PRETEST VCE/ NULL VCE)
  pretest_covR = 1-as.numeric(pretest_cov_VCE)/as.numeric(NULL_VCE), 
  ## 1 - (DEMO VCE / NULL VCE)
  demo_covR = 1-as.numeric(demo_cov_VCE)/as.numeric(NULL_VCE), 
  ## 1 - (FULL VCE / NULL VCE)
  covR = 1-as.numeric(full_VCE)/as.numeric(NULL_VCE))
## Warning: There was 1 warning in `dplyr::mutate()`.
## ℹ In argument: `pretest_covR = 1 -
##   as.numeric(pretest_cov_VCE)/as.numeric(NULL_VCE)`.
## Caused by warning:
## ! NAs introduced by coercion
</code></pre>
<pre><code class="language-r">cov &lt;- icc_cov %&gt;% select(Source_k, level_VCE, covR, demo_covR, demo_cov, pretest_covR, L1_variance_3, L2_variance_3, L3_variance_3, L4_variance_3, ICC_2, ICC_3, ICC_4) %&gt;% pivot_wider(names_from = level_VCE, values_from = c(covR, demo_covR, demo_cov, pretest_covR))
</code></pre>
<h3 id="effect-size">EFFECT SIZE</h3>
<pre><code class="language-r">#effect_size &lt;- effect_size %&gt;% filter(d_adj != &quot;adj&quot; | is.na(d_adj))
eff_ss &lt;- left_join(effect_size, sample_size, &quot;Source_k&quot;)
eff_ss &lt;- eff_ss %&gt;% select(-L1_variance_3, -L2_variance_3, -L3_variance_3, -L4_variance_3, -ICC_1, -ICC_2, -ICC_3, -ICC_4, -L1_variance_2, -L2_variance_2,)
eff_ss &lt;- left_join(eff_ss, cov, &quot;Source_k&quot;)

## Drop if contrast is NA
eff_ss &lt;- eff_ss %&gt;% drop_na(d_contrast)

## Set contrast sample sizes:
eff_ss &lt;- eff_ss %&gt;% mutate(L1_condition_N_1 = if_else(d_contrast == &quot;2v3&quot;, L1_condition_N.2, L1_condition_N.1),
                            L1_condition_N_2 = if_else(d_contrast == &quot;1v2&quot;, L1_condition_N.2, L1_condition_N.3),
                            L2_condition_N_1 = if_else(d_contrast == &quot;2v3&quot;, L2_condition_N.2, L2_condition_N.1),
                            L2_condition_N_2 = if_else(d_contrast == &quot;1v2&quot;, L2_condition_N.2, L2_condition_N.3),
                            L3_condition_N_1 = if_else(d_contrast == &quot;2v3&quot;, L3_condition_N.2, L3_condition_N.1),
                            L3_condition_N_2 = if_else(d_contrast == &quot;1v2&quot;, L3_condition_N.2, L3_condition_N.3),
                            L4_condition_N_1 = if_else(d_contrast == &quot;2v3&quot;, L4_condition_N.2, L4_condition_N.1),
                            L4_condition_N_2 = if_else(d_contrast == &quot;1v2&quot;, L4_condition_N.2, L4_condition_N.3))
</code></pre>
<pre><code class="language-r">## Time transformations
eff_ss &lt;- eff_ss %&gt;% dplyr::mutate(duration = if_else(standard_time_interval == &quot;Yes&quot;, as.numeric(measurement_interval_num) * (num_timepoints-1), 
                                                      if_else(num_timepoints ==2, as.numeric(gsub(&quot;[^0-9.-]&quot;, &quot;&quot;, follow_up1)), 
                                                              if_else(num_timepoints ==3, as.numeric(gsub(&quot;[^0-9.-]&quot;, &quot;&quot;, follow_up2)),
                                                                      if_else(num_timepoints ==4, as.numeric(gsub(&quot;[^0-9.-]&quot;, &quot;&quot;, follow_up3)), 3)))),
                                   follow_up1 = if_else(standard_time_interval == &quot;Yes&quot;, as.numeric(measurement_interval_num), 
                                                        as.numeric(gsub(&quot;[^0-9.-]&quot;, &quot;&quot;, follow_up1))))
</code></pre>
<pre><code class="language-r">## Raw SD transformation
eff_ss &lt;- eff_ss %&gt;% dplyr::mutate(num_levels = as.numeric(gsub(&quot;\\+&quot;, &quot;&quot;, `num_levels`)),
                                   d_raw_SD = if_else(!is.na(d_raw_SD), as.numeric(d_raw_SD),
                                                      if_else(num_levels == 4, sqrt(as.numeric(L1_variance_3) + as.numeric(L2_variance_3) + as.numeric(L3_variance_3) + as.numeric(L4_variance_3)),
                                                              if_else(num_levels == 3, sqrt(as.numeric(L1_variance_3) + as.numeric(L2_variance_3) + as.numeric(L3_variance_3)),
                                                                      if_else(num_levels == 2, sqrt(as.numeric(L1_variance_3) + as.numeric(L2_variance_3)), NA))))) 
## Effect size transformations
eff_ss &lt;- eff_ss %&gt;% dplyr::mutate(
  d_cont = as.numeric(reg_coef)/as.numeric(d_raw_SD), # endpoint analysis or categorical time
  d_binary = as.numeric(reg_coef) * sqrt(3)/pi, #it spits out a logit and its converted
  ## Time-varying effect size
  d_long_cat = as.numeric(reg_coef_tx)/as.numeric(d_raw_SD), # Categorical time reg_coef is already multiplied by the duration. 
  d_long_piecewise = (as.numeric(reg_coef_tx)*follow_up1)/as.numeric(d_raw_SD), # Input directly into distillerSR
  d_long_linear = (as.numeric(reg_coef_tx)*as.numeric(duration))/as.numeric(d_raw_SD),
  d_long_quadratic = ((as.numeric(reg_coef_tx)*as.numeric(duration)) + ((as.numeric(reg_coef_tx_q)*as.numeric(duration)^2)))/as.numeric(d_raw_SD),
  ## Extract effect size from t-value or p-value (Need to add bias correction)
  d_t_test =  if_else(d_CR_type == &quot;t&quot;, as.numeric(d_CR) * sqrt(1/as.numeric(L1_condition_N_1) + 1/as.numeric(L1_condition_N_2)), NA),
  d_from_pval =  pt(as.numeric(gsub(&quot;[^0-9.-]&quot;, &quot;&quot;, d_pval))/2, 100) * sqrt(1/as.numeric(L1_condition_N_1) + 1/as.numeric(L1_condition_N_2)),
  d_author = as.numeric(gsub(&quot;[^0-9.-]&quot;, &quot;&quot;, d_author)))
## Warning: There were 2 warnings in `dplyr::mutate()`.
## The first warning was:
## ℹ In argument: `d_long_quadratic = `/`(...)`.
## Caused by warning:
## ! NAs introduced by coercion
## ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.
</code></pre>
<h3 id="components-for-variance-estimates">COMPONENTS FOR VARIANCE ESTIMATES</h3>
<pre><code class="language-r">eff_ss &lt;- eff_ss %&gt;% 
  mutate(tot_v2 = if_else(num_levels == 2, as.numeric(L1_variance_3)+as.numeric(L2_variance_3), NA), # Total variance at level 2
         tot_v3 = if_else(num_levels == 3, as.numeric(L1_variance_3)+as.numeric(L2_variance_3)+as.numeric(L3_variance_3), NA), # Total variance at level 3
         tot_v4 = if_else(num_levels == 4, as.numeric(L1_variance_3)+as.numeric(L2_variance_3)+as.numeric(L3_variance_3)+as.numeric(L4_variance_3), NA), # Total variance at level 4

         L1_ss = if_else(is.na(L1_ss), as.numeric(L1_condition_N_1) + as.numeric(L1_condition_N_2), as.numeric(L1_ss)), # Add L1 conditions sample size together to make L1 sample size, if L1 sample size isn't already there.
         L2_ss = if_else(is.na(L2_ss), as.numeric(L2_condition_N_1) + as.numeric(L2_condition_N_2), as.numeric(L2_ss)), # .
         L3_ss = if_else(is.na(L3_ss), as.numeric(L3_condition_N_1) + as.numeric(L3_condition_N_2), as.numeric(L3_ss)), # .
         L4_ss = if_else(is.na(L4_ss), as.numeric(L4_condition_N_1) + as.numeric(L4_condition_N_2), as.numeric(L4_ss)), 
         vi_r2_1 = 4*covR_1*(1-covR_1)^2 / L1_ss, # Variance of COV-R^2 at L1
         vi_r2_2 = 4*covR_2*(1-covR_2)^2 / L2_ss,
         vi_r2_3 = 4*covR_3*(1-covR_3)^2 / L3_ss,
        clus_1_2 = L1_ss/L2_ss, # Average number of L1 obs in L2 clusters.
        #clus_1_3 = L1_ss/L3_ss, # Average number of L1 obs in L3 clusters.
        clus_2_3 = L2_ss/L3_ss, # Average number of L2 obs in L3 clusters.
        clus_3_4 = L3_ss/L4_ss, # Average number of L3 obs in L4 clusters.
        v2 = as.numeric(L2_variance_3_se)^2, # Variance of L2 Variance
        v3 = as.numeric(L3_variance_3_se)^2, # Variance of L3 Variance
        v4 = as.numeric(L4_variance_3_se)^2, # Variance of L4 Variance
        vi_icc_2 = if_else(num_levels == 2, (2*(1-ICC_2)^2 * (1+(clus_1_2-1)*ICC_2)^2)/(clus_1_2*(clus_1_2-1)*(L2_ss-1)), # Variance of ICC @ L2
                       if_else(num_levels == 3, (((clus_2_3*(1-ICC_2)^2 + 2*ICC_2*(1-ICC_2))*v2)/(clus_2_3*tot_v3^2)) + ((ICC_2^2 * v3)/tot_v3^2),
                               if_else(num_levels == 4, ((clus_3_4*clus_2_3^2*(1-ICC_2)^2+2*clus_3_4*clus_2_3*ICC_2*(1-ICC_2)+2*ICC_2^2)*v2)/(clus_3_4*clus_2_3^2*tot_v4^2)+((clus_3_4-2)*ICC_2^2*v3)/(clus_3_4*tot_v4^2)+(ICC_2^2*v4)/tot_v4^2, NA))),
                       
        vi_icc_3 = if_else(num_levels == 3, (((clus_2_3*(ICC_3)^2 + 2*ICC_3*(1-ICC_3))*v2)/(clus_2_3*tot_v3^2)) + (((1-ICC_3)^2 * v3)/tot_v3^2),
                           
                         if_else(num_levels == 4, (((clus_3_4*clus_2_3^2*ICC_3^2 + 2*(clus_3_4*clus_2_3 - 1)*ICC_3*(1-ICC_3))*v2)/(clus_3_4*clus_2_3^2*tot_v4^2))+ ((((clus_3_4*(1-ICC_3)^2)+(2*ICC_3*(1-ICC_3)))*v3)/(clus_3_4*tot_v4^2))+((ICC_3^2*v4)/tot_v4^2), NA)),
        
        vi_icc_4 = if_else(num_levels == 4, (((clus_3_4*clus_2_3*(clus_2_3 - 2)*ICC_4^2 - 2*ICC_4*(1-ICC_4))*v2)/(clus_3_4*clus_2_3^2*tot_v4^2))+(((clus_3_4*ICC_4^2+2*ICC_4*(1-ICC_4))*v3)/(clus_3_4*tot_v4^2))+((1-ICC_4)^2*v4)/tot_v4^2, NA)) # Variance of ICC @ L3 
</code></pre>
<h3 id="pivot-longer-to-create-effect-size-parameter-components">PIVOT LONGER TO CREATE EFFECT SIZE PARAMETER COMPONENTS:</h3>
<pre><code class="language-r">eff_ss_long &lt;- eff_ss %&gt;% pivot_longer(c(&quot;d_author&quot;, &quot;d_binary&quot;, &quot;d_cont&quot;, &quot;d_long_piecewise&quot;, &quot;d_long_cat&quot;, &quot;d_long_linear&quot;, &quot;d_long_quadratic&quot;, &quot;d_t_test&quot;, &quot;d_from_pval&quot;), names_to = &quot;dtype&quot;, values_to = &quot;dval&quot;) #%&gt;% drop_na(dval)

eff_ss_long &lt;- eff_ss_long %&gt;% 
  mutate(analysis_type = if_else(str_detect(analysis_type, &quot;binary&quot;) == T, &quot;binary&quot;, 
                                                                      if_else(str_detect(analysis_type, &quot;cont&quot;) == T, &quot;cont&quot;,
                                                                              if_else(analysis_type == &quot;ep&quot;, &quot;cont&quot;, &quot;long&quot;))),
         analysis_match = if_else(dtype == &quot;d_cont&quot; &amp; analysis_type == &quot;cont&quot; &amp; data_source == &quot;PI&quot;, 1, 
                                  if_else(dtype == &quot;d_binary&quot; &amp; analysis_type == &quot;binary&quot; &amp; data_source == &quot;PI&quot;, 1, 
                                    if_else(dtype == &quot;d_long_cat&quot; &amp; time_modeled == &quot;cat&quot;, 1, 
                                     if_else(dtype == &quot;d_long_piecewise&quot; &amp; time_modeled == &quot;piecewise&quot;, 1,
                                          if_else(dtype == &quot;d_long_linear&quot; &amp; time_modeled == &quot;linear&quot;, 1,
                                                  if_else(dtype == &quot;d_long_quadratic&quot; &amp; time_modeled == &quot;quad&quot;,  1, 
                                                          if_else(dtype == &quot;d_author&quot; &amp; data_source == &quot;Paper&quot; &amp; analysis_type == &quot;cont&quot;, 1,
                                                                  if_else(dtype == &quot;d_from_pval&quot; &amp; data_source == &quot;Paper&quot; &amp; analysis_type == &quot;cont&quot;, 1,
                                                                          if_else(dtype == &quot;d_t_test&quot; &amp; data_source == &quot;Paper&quot;&amp; analysis_type == &quot;cont&quot;, 1, 0))))))))),
    num_levels = as.numeric(gsub(&quot;\\+&quot;, &quot;&quot;, `num_levels`)),
    vi = if_else(dtype == &quot;d_cont&quot; &amp; num_levels == 2, (as.numeric(reg_coef_se)^2/tot_v2) + (as.numeric(reg_coef)^2 * as.numeric(L2_variance_3_se)^2)/(4*(tot_v2)^3),
                 if_else(dtype == &quot;d_cont&quot; &amp; num_levels == 3, (as.numeric(reg_coef_se)^2/tot_v3) + (as.numeric(reg_coef)^2 * (as.numeric(L2_variance_3_se)^2 + as.numeric(L3_variance_3_se)^2))/(4*tot_v3^3),
                         if_else(dtype == &quot;d_cont&quot; &amp; num_levels == 4, (as.numeric(reg_coef_se)^2/tot_v4) + (as.numeric(reg_coef)^2 * (as.numeric(L2_variance_3_se)^2 + as.numeric(L3_variance_3_se)^2 + as.numeric(L4_variance_3_se)^2))/(4*tot_v4^3),
                         if_else(dtype == &quot;d_long_linear&quot; | dtype == &quot;d_long_quadratic&quot; | dtype == &quot;d_long_piecewise&quot; | dtype == &quot;d_long_cat&quot;, as.numeric(reg_coef_tx_se)^2 * (as.numeric(dval)/as.numeric(reg_coef_tx))^2, 
                                                 if_else(dtype == &quot;d_binary&quot;, 3*as.numeric(reg_coef_se)^2/pi^2, NA)))))) %&gt;% filter(analysis_match == 1) %&gt;% select(Refid:software, L1_ss:num_levels, d_contrast:d_adj, L1_variance_3:L4_variance_3, follow_up1, duration, analysis_type, time_modeled, dtype:vi)

</code></pre>
<h2 id="meta-analyze">META-ANALYZE:</h2>
<h3 id="icc-and-cov-r2">ICC AND COV R^2</h3>
<ul>
<li>Analyzed at the outcome level.</li>
</ul>
<pre><code class="language-r">icc_cov_meta &lt;- eff_ss %&gt;% select(Refid, Source_k, data_source:L3_ss, L1_analysis_name, L2_analysis_name, L3_analysis_name, L4_analysis_name, L4_ss, num_levels, L1_variance_3_se, L2_variance_3_se, L3_variance_3_se, L4_variance_3_se, L1_variance_3:pretest_covR_2, tot_v2:vi_icc_4)
icc_cov_meta &lt;- icc_cov_meta %&gt;% separate(col = Source_k, into = c(&quot;study&quot;, &quot;determinant&quot;, &quot;dv_name&quot;, &quot;dv_source&quot;), sep = &quot;\\|&quot;) %&gt;% select(-dv_source)
icc_cov_meta &lt;- left_join(icc_cov_meta, outcomes, c(&quot;Refid&quot;, &quot;dv_name&quot;))
metadata &lt;- metadata %&gt;% select(Refid, Author, hybrid_type:rand_L4)
icc_cov_meta &lt;- left_join(icc_cov_meta, metadata, &quot;Refid&quot;)


icc_meta_pi &lt;- icc_cov_meta %&gt;% filter(data_source == &quot;PI&quot;) %&gt;% distinct() %&gt;% select(Author, Refid, dv_name, study, analysis_type, dv_outcome, dv_measure_approach, L1_name, L2_name, L3_name, L1_analysis_name, L2_analysis_name, L3_analysis_name, L4_analysis_name, num_levels, L1_variance_3, L2_variance_3, L3_variance_3, L4_variance_3, L1_variance_3_se, L2_variance_3_se, L3_variance_3_se, L4_variance_3_se, L1_ss, L2_ss, L3_ss, L4_ss, clus_1_2, clus_1_2, ICC_2, vi_icc_2, ICC_3, vi_icc_3, ICC_4, vi_icc_4, covR_1, vi_r2_1, covR_2, vi_r2_2)

cov_meta_pi &lt;- icc_cov_meta %&gt;% filter(data_source == &quot;PI&quot;) %&gt;% distinct() %&gt;% select(Author, Refid, dv_name, study, analysis_type, dv_outcome, dv_measure_approach, L1_name, L2_name, L3_name, L1_analysis_name, L2_analysis_name, L3_analysis_name, L4_analysis_name, num_levels, L1_variance_3, L2_variance_3, L3_variance_3, L4_variance_3, L1_variance_3_se, L2_variance_3_se, L3_variance_3_se, covR_1, vi_r2_1, covR_2, vi_r2_2)

#icC_cov_meta_paper &lt;- icc_cov_meta %&gt;% filter(data_source == &quot;Paper&quot;) %&gt;% distinct() %&gt;% select(Author, Refid, dv_name, study, analysis_type, dv_outcome, L1_name, L2_name, L3_name, L4_name, num_levels, L1_variance_3, L2_variance_3, L3_variance_3, L4_variance_3, L1_variance_3_se, L2_variance_3_se, L3_variance_3_se, L4_variance_3_se, L1_ss, L2_ss, L3_ss, L4_ss, clus_1_2, clus_1_3, clus_1_2, ICC_2, vi_icc_2, ICC_3, vi_icc_3, covR_1, vi_r2_1, covR_2, vi_r2_2)
</code></pre>
<pre><code class="language-r">icc_meta_pi &lt;- icc_meta_pi %&gt;% 
  mutate(L1_name = if_else(is.na(L1_name), L1_analysis_name, L1_name),
         L2_name= if_else(is.na(L2_name), L2_analysis_name, L2_name),
         L3_name= if_else(is.na(L3_name), L3_analysis_name, L3_name),
         L4_name= L4_analysis_name, # Right now, L4_name doesn't exist because there isn't a variable with data at the study characteristics level, only at the outcome level because of the two weird cases where we have differing model structures depending on the outcome in Epstein and Cara Lewis.
         
         analysis_type = if_else(str_detect(analysis_type, &quot;binary&quot;) == T, &quot;binary&quot;, 
                                                                      if_else(str_detect(analysis_type, &quot;cont&quot;) == T, &quot;cont&quot;,
                                                                              if_else(analysis_type == &quot;ep&quot;, &quot;cont&quot;, &quot;long&quot;))),
         longitudinal = if_else(analysis_type == &quot;long&quot;, 1, 0),
         outcome_type = if_else(dv_outcome == &quot;symptoms&quot; | dv_outcome == &quot;functioning&quot;, &quot;clinical&quot;, &quot;implementation&quot;),
         measurement_approach = if_else(dv_measure_approach == &quot;provider&quot; | dv_measure_approach == &quot;participant&quot;, &quot;self_report&quot;, 
                                        if_else(is.na(dv_measure_approach), NA, &quot;coded/recorded&quot;)))

icc_meta_pi &lt;- icc_meta_pi %&gt;% pivot_longer(c(ICC_2, ICC_3, ICC_4), names_to = &quot;level_ICC&quot;, values_to = &quot;ICC&quot;) %&gt;% 
  mutate(analysis_index = paste0(analysis_type, num_levels, level_ICC)) %&gt;% mutate(cluster_level = if_else(level_ICC == &quot;ICC_2&quot;, L2_name,
                                                                                                           if_else(level_ICC == &quot;ICC_3&quot;, L3_name, NA)), 
                                                                                   ICC_vi = if_else(level_ICC == &quot;ICC_2&quot;, vi_icc_2,
                                                                                                    if_else(level_ICC == &quot;ICC_3&quot;, vi_icc_3, 
                                                                                                            if_else(level_ICC == &quot;ICC_4&quot;, vi_icc_4, NA))))
</code></pre>
<pre><code class="language-r"># Make the non-longitudinal, first-cluster data set.
icC_cov_meta_pi_L2 &lt;- icc_meta_pi %&gt;% filter(analysis_index == &quot;long4ICC_3&quot; | analysis_index == &quot;long3ICC_3&quot; | analysis_index == &quot;cont3ICC_2&quot; | analysis_index == &quot;binary3ICC_2&quot; | analysis_index == &quot;cont2ICC_2&quot; | analysis_index == &quot;binary2ICC_2&quot;) %&gt;% filter(!is.na(ICC))

# Make the non-longitudinal, second-cluster data set.

icC_cov_meta_pi_L3 &lt;- icc_meta_pi %&gt;% filter(analysis_index == &quot;long4ICC_4&quot; | analysis_index == &quot;cont3ICC_3&quot; | analysis_index == &quot;binary3ICC_3&quot;)

# Make the longitudinal data set
icC_cov_meta_pi_long &lt;- icc_meta_pi %&gt;% filter(analysis_index == &quot;long4ICC_2&quot; | analysis_index == &quot;long3ICC_2&quot; | analysis_index == &quot;long2ICC_2&quot;)

# Fix the observations of Epstein's 4-level variable.
#icC_cov_meta_pi_long[4, 8] &lt;- &quot;obs&quot;
#icC_cov_meta_pi_long[4, 9] &lt;- &quot;patient&quot;
#icC_cov_meta_pi_long[4, 10] &lt;- &quot;provider&quot;
#icC_cov_meta_pi_long[4, 11] &lt;- &quot;site&quot;
</code></pre>
<pre><code class="language-r">summary(icC_cov_meta_pi_L2$ICC)
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.00000 0.05742 0.08781 0.12913 0.24039 0.38376
summary(icC_cov_meta_pi_L3$ICC)
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.00000 0.06293 0.09229 0.10073 0.14634 0.19431
summary(icC_cov_meta_pi_long$ICC)
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.1193  0.2134  0.3526  0.3810  0.5186  0.7074


IQR(icC_cov_meta_pi_L2$ICC)
## [1] 0.1829735
IQR(icC_cov_meta_pi_L3$ICC)
## [1] 0.08340827
IQR(icC_cov_meta_pi_long$ICC)
## [1] 0.3051323
</code></pre>
<h3 id="visualize-icc-and-cov-r2-estimate">Visualize ICC and COV R^2 Estimate</h3>
<pre><code class="language-r">meta_icc_L2 &lt;- icC_cov_meta_pi_L2 %&gt;% filter(!is.na(ICC_vi))
meta_icc_L3 &lt;- icC_cov_meta_pi_L3 %&gt;% filter(!is.na(ICC_vi)) 
meta_icc_long &lt;- icC_cov_meta_pi_long %&gt;% filter(!is.na(ICC_vi)) 

ma_model_2 &lt;- rma.mv(yi = ICC, V = ICC_vi, random = ~ 1 | dv_name/study, data = meta_icc_L2)
ma_model_2i &lt;- rma.mv(yi = ICC, V = ICC_vi, mods = as.factor(measurement_approach), random = ~ 1 | dv_name/study, data = meta_icc_L2) # Test for moderating force of measurement approach.

ma_model_3 &lt;- rma.mv(yi = ICC, V = ICC_vi, random = ~ 1 | dv_name/study, data = meta_icc_L3)
ma_model_2_long &lt;- rma.mv(yi = ICC, V = ICC_vi, random = ~ 1 | dv_name/study, data = meta_icc_long)

summary(ma_model_2)
## 
## Multivariate Meta-Analysis Model (k = 17; method: REML)
## 
##   logLik  Deviance       AIC       BIC      AICc   
##   8.3507  -16.7014  -10.7014   -8.3836   -8.7014   
## 
## Variance Components:
## 
##             estim    sqrt  nlvls  fixed         factor 
## sigma^2.1  0.0076  0.0870     17     no        dv_name 
## sigma^2.2  0.0076  0.0870     17     no  dv_name/study 
## 
## Test for Heterogeneity:
## Q(df = 16) = 997.2032, p-val &lt; .0001
## 
## Model Results:
## 
## estimate      se    zval    pval   ci.lb   ci.ub      
##   0.1466  0.0371  3.9506  &lt;.0001  0.0739  0.2194  *** 
## 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
summary(ma_model_3)
## 
## Multivariate Meta-Analysis Model (k = 5; method: REML)
## 
##   logLik  Deviance       AIC       BIC      AICc   
##   5.6090  -11.2181   -5.2181   -7.0592   18.7819   
## 
## Variance Components:
## 
##             estim    sqrt  nlvls  fixed         factor 
## sigma^2.1  0.0004  0.0209      5     no        dv_name 
## sigma^2.2  0.0004  0.0209      5     no  dv_name/study 
## 
## Test for Heterogeneity:
## Q(df = 4) = 6.6893, p-val = 0.1532
## 
## Model Results:
## 
## estimate      se    zval    pval   ci.lb   ci.ub      
##   0.1023  0.0208  4.9201  &lt;.0001  0.0615  0.1430  *** 
## 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
summary(ma_model_2_long)
## 
## Multivariate Meta-Analysis Model (k = 11; method: REML)
## 
##   logLik  Deviance       AIC       BIC      AICc   
##   1.7688   -3.5375    2.4625    3.3703    6.4625   
## 
## Variance Components:
## 
##             estim    sqrt  nlvls  fixed         factor 
## sigma^2.1  0.0193  0.1388     11     no        dv_name 
## sigma^2.2  0.0193  0.1388     11     no  dv_name/study 
## 
## Test for Heterogeneity:
## Q(df = 10) = 9898.7726, p-val &lt; .0001
## 
## Model Results:
## 
## estimate      se    zval    pval   ci.lb   ci.ub      
##   0.3925  0.0618  6.3533  &lt;.0001  0.2714  0.5135  *** 
## 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

forest(ma_model_2, slab = paste(gsub(&quot;,&quot;, &quot;&quot;, str_sub(meta_icc_L2$Author, 1, 10)), str_sub(meta_icc_L2$dv_name, 1, 10), cluster_level, sep = &quot;, &quot;))
title(&quot;ICC, Non-longitudinal clusters L2&quot;)
</code></pre>
<img src="https://example.com/2023-08-09-casper-meta-analysis/index.en_files/figure-html/unnamed-chunk-21-1.png" width="672" />
<pre><code class="language-r">
forest(ma_model_3, slab = paste(gsub(&quot;,&quot;, &quot;&quot;, str_sub(meta_icc_L3$Author, 1, 10)), str_sub(meta_icc_L3$dv_name, 1, 10), cluster_level, sep = &quot;, &quot;))
title(&quot;ICC, Non-longitudinal clusters L3&quot;)
</code></pre>
<img src="https://example.com/2023-08-09-casper-meta-analysis/index.en_files/figure-html/unnamed-chunk-21-2.png" width="672" />
<pre><code class="language-r">
forest(ma_model_2_long, slab = paste(gsub(&quot;,&quot;, &quot;&quot;, str_sub(meta_icc_long$Author, 1, 10)), str_sub(meta_icc_long$dv_name, 1, 10), cluster_level, sep = &quot;, &quot;))
title(&quot;ICC, Longitudinal clusters&quot;)
</code></pre>
<img src="https://example.com/2023-08-09-casper-meta-analysis/index.en_files/figure-html/unnamed-chunk-21-3.png" width="672" />
<pre><code class="language-r">

clubSandwich::coef_test(ma_model_2, vcov = &quot;CR2&quot;)# RVE using small-sample adjustment from Tipton and Pustejovsky (2015)
## Registered S3 method overwritten by 'clubSandwich':
##   method    from    
##   bread.mlm sandwich
##    Coef. Estimate     SE t-stat d.f. (Satt) p-val (Satt) Sig.
##  intrcpt    0.147 0.0374   3.92          13      0.00175   **
clubSandwich::coef_test(ma_model_3, vcov = &quot;CR2&quot;)# RVE using small-sample adjustment from Tipton and Pustejovsky (2015)
##    Coef. Estimate     SE t-stat d.f. (Satt) p-val (Satt) Sig.
##  intrcpt    0.102 0.0193   5.31        2.41       0.0223    *
clubSandwich::coef_test(ma_model_2_long, vcov = &quot;CR2&quot;)# RVE using small-sample adjustment from Tipton and Pustejovsky (2015)
##    Coef. Estimate     SE t-stat d.f. (Satt) p-val (Satt) Sig.
##  intrcpt    0.392 0.0618   6.35        9.89       &lt;0.001  ***
</code></pre>
<h4 id="mixed-effects-model">Mixed effects model</h4>
<h5 id="account-for-clustering-in-the-results-but-dont-meta-analyze">Account for clustering in the results, but don&rsquo;t meta-analyze</h5>
<pre><code class="language-r">library(lme4) # Mixed effects models
#lm(ICC ~ 1, data = icC_cov_meta_pi_L2)

m1 = lmer(ICC ~ 1 + (1 | Refid), data = icC_cov_meta_pi_L2) # Level 2

summary(lmer(ICC ~ outcome_type + (1 | Refid), data = icC_cov_meta_pi_L2)) # Level 2
## Linear mixed model fit by REML ['lmerMod']
## Formula: ICC ~ outcome_type + (1 | Refid)
##    Data: icC_cov_meta_pi_L2
## 
## REML criterion at convergence: -28.8
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.3309 -0.5015 -0.2599  0.4132  1.6961 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  Refid    (Intercept) 0.009748 0.09873 
##  Residual             0.007166 0.08465 
## Number of obs: 21, groups:  Refid, 6
## 
## Fixed effects:
##                            Estimate Std. Error t value
## (Intercept)                 0.08038    0.07659   1.049
## outcome_typeimplementation  0.09683    0.07623   1.270
## 
## Correlation of Fixed Effects:
##             (Intr)
## otcm_typmpl -0.801
summary(lmer(ICC ~ measurement_approach + (1 | Refid), data = icC_cov_meta_pi_L2)) # Level 2
## Linear mixed model fit by REML ['lmerMod']
## Formula: ICC ~ measurement_approach + (1 | Refid)
##    Data: icC_cov_meta_pi_L2
## 
## REML criterion at convergence: -28.2
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.23664 -0.68167  0.04445  0.38071  2.00374 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  Refid    (Intercept) 0.018691 0.13672 
##  Residual             0.006253 0.07907 
## Number of obs: 21, groups:  Refid, 6
## 
## Fixed effects:
##                                 Estimate Std. Error t value
## (Intercept)                      0.13266    0.06476   2.049
## measurement_approachself_report  0.08319    0.07091   1.173
## 
## Correlation of Fixed Effects:
##             (Intr)
## msrmnt_ppr_ -0.391


m2 = lmer(ICC ~ 1 + (1 | Refid), data = icC_cov_meta_pi_L3) # Level 3
m3 = lmer(ICC ~ 1 + (1 | Refid), data = icC_cov_meta_pi_long) # Longitudinal

m1
## Linear mixed model fit by REML ['lmerMod']
## Formula: ICC ~ 1 + (1 | Refid)
##    Data: icC_cov_meta_pi_L2
## REML criterion at convergence: -30.6038
## Random effects:
##  Groups   Name        Std.Dev.
##  Refid    (Intercept) 0.11002 
##  Residual             0.08383 
## Number of obs: 21, groups:  Refid, 6
## Fixed Effects:
## (Intercept)  
##      0.1597
stats::confint(m1, method=&quot;Wald&quot;)
##                  2.5 %    97.5 %
## .sig01              NA        NA
## .sigma              NA        NA
## (Intercept) 0.06176902 0.2576201

m2
## Linear mixed model fit by REML ['lmerMod']
## Formula: ICC ~ 1 + (1 | Refid)
##    Data: icC_cov_meta_pi_L3
## REML criterion at convergence: -13.3221
## Random effects:
##  Groups   Name        Std.Dev.
##  Refid    (Intercept) 0.03987 
##  Residual             0.06254 
## Number of obs: 7, groups:  Refid, 3
## Fixed Effects:
## (Intercept)  
##     0.08718
stats::confint(m2, method=&quot;Wald&quot;)
##                  2.5 %    97.5 %
## .sig01              NA        NA
## .sigma              NA        NA
## (Intercept) 0.01723689 0.1571276

m3
## Linear mixed model fit by REML ['lmerMod']
## Formula: ICC ~ 1 + (1 | Refid)
##    Data: icC_cov_meta_pi_long
## REML criterion at convergence: -10.9698
## Random effects:
##  Groups   Name        Std.Dev.
##  Refid    (Intercept) 0.19350 
##  Residual             0.09057 
## Number of obs: 14, groups:  Refid, 6
## Fixed Effects:
## (Intercept)  
##      0.4092
stats::confint(m3, method=&quot;Wald&quot;)
##                 2.5 %    97.5 %
## .sig01             NA        NA
## .sigma             NA        NA
## (Intercept) 0.2462642 0.5721137
</code></pre>
<h4 id="clustered-standard-errors">Clustered Standard Errors</h4>
<pre><code class="language-r">library(sandwich) # Working with clustered covariances
library(miceadds) # AUtomated function to work with clustered-random errors
## Loading required package: mice
## 
## Attaching package: 'mice'
## The following object is masked from 'package:stats':
## 
##     filter
## The following objects are masked from 'package:base':
## 
##     cbind, rbind
## * miceadds 3.16-18 (2023-01-06 10:54:00)
m1 = lm.cluster(ICC ~ 1, cluster = 'Refid', data = icC_cov_meta_pi_L2)
summary(lm.cluster(ICC ~ longitudinal, cluster = 'Refid', data = icC_cov_meta_pi_L2))
## R^2= 0.00402 
## 
##                Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept)  0.12443510 0.02788415 4.4625753 8.098046e-06
## longitudinal 0.01642071 0.11034674 0.1488101 8.817034e-01
summary(lm.cluster(ICC ~ outcome_type, cluster = 'Refid', data = icC_cov_meta_pi_L2))
## R^2= 0.10733 
## 
##                              Estimate Std. Error  t value    Pr(&gt;|t|)
## (Intercept)                0.03518436 0.01864113 1.887459 0.059098669
## outcome_typeimplementation 0.10959943 0.03801050 2.883399 0.003934089
summary(lm.cluster(ICC ~ measurement_approach, cluster = 'Refid', data = icC_cov_meta_pi_L2))
## R^2= 0.00692 
## 
##                                  Estimate Std. Error  t value   Pr(&gt;|t|)
## (Intercept)                     0.1229657 0.05056761 2.431710 0.01502775
## measurement_approachself_report 0.0215635 0.07068331 0.305072 0.76031129

m2 = lm.cluster(ICC ~ 1, cluster = 'Refid', data = icC_cov_meta_pi_L3)
m3 = lm.cluster(ICC ~ 1, cluster = 'Refid', data = icC_cov_meta_pi_long)
summary(lm.cluster(ICC ~ outcome_type, cluster = 'Refid', data = icC_cov_meta_pi_long))
## R^2= 0.07601 
## 
##                             Estimate Std. Error   t value   Pr(&gt;|t|)
## (Intercept)                0.2977709  0.1035684 2.8751121 0.00403884
## outcome_typeimplementation 0.1164576  0.1243373 0.9366263 0.34895083
summary(lm.cluster(ICC ~ measurement_approach, cluster = 'Refid', data = icC_cov_meta_pi_long))
## R^2= 0.09609 
## 
##                                  Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept)                     0.3126508 0.06507261 4.804646 1.550259e-06
## measurement_approachself_report 0.1195321 0.11320318 1.055907 2.910105e-01


m1
## $lm_res
## 
## Call:
## stats::lm(formula = formula, data = data, weights = wgt__)
## 
## Coefficients:
## (Intercept)  
##      0.1291  
## 
## 
## $vcov
##             (Intercept)
## (Intercept) 0.001300772
## 
## attr(,&quot;class&quot;)
## [1] &quot;lm.cluster&quot;
stats::confint(m1, method=&quot;Wald&quot;)
##                  2.5 %    97.5 %
## (Intercept) 0.05843826 0.1998152

m2
## $lm_res
## 
## Call:
## stats::lm(formula = formula, data = data, weights = wgt__)
## 
## Coefficients:
## (Intercept)  
##      0.1007  
## 
## 
## $vcov
##              (Intercept)
## (Intercept) 0.0006776838
## 
## attr(,&quot;class&quot;)
## [1] &quot;lm.cluster&quot;
stats::confint(m2, method=&quot;Wald&quot;)
##                  2.5 %    97.5 %
## (Intercept) 0.04970978 0.1517548

m3
## $lm_res
## 
## Call:
## stats::lm(formula = formula, data = data, weights = wgt__)
## 
## Coefficients:
## (Intercept)  
##       0.381  
## 
## 
## $vcov
##             (Intercept)
## (Intercept) 0.006245564
## 
## attr(,&quot;class&quot;)
## [1] &quot;lm.cluster&quot;
stats::confint(m3, method=&quot;Wald&quot;)
##                 2.5 %    97.5 %
## (Intercept) 0.2260611 0.5358486
</code></pre>
<h4 id="plot-icc-estimates">Plot ICC Estimates</h4>
<pre><code class="language-r"># I manually input the estimates into a separate Excel workbook.
#icc_est &lt;- read_xlsx(&quot;ICC_estimates.xlsx&quot;)
library(ggplot2)

#icc_plot &lt;- ggplot(data = icc_est, mapping = aes(y = analysis, x= estimate, color = est_type)) + geom_point(position = position_dodge(width = 1), aes(shape = analysis, size = n_studies), show.legend = F) + geom_linerange(aes(xmin = lowerbound, xmax = upperbound), position = position_dodge(width = 1), size = .8) + xlab(&quot;ICC Estiamte&quot;) + coord_flip()

#icc_plot
#ggsave(&quot;ICC_estimates_plot.png&quot;, icc_plot)
</code></pre>
<h2 id="cov-r-squared">COV R-SQUARED</h2>
<pre><code class="language-r">meta_r2_L2 &lt;- cov_meta_pi %&gt;% filter(!is.na(vi_r2_1) &amp; vi_r2_1 &gt; 0)
meta_r2_L3 &lt;- cov_meta_pi %&gt;% filter(!is.na(vi_r2_2) &amp; vi_r2_2 &gt; 0)
#meta_r2_L4 &lt;- cov_meta_pi %&gt;% filter(!is.na(vi_r2_3) &amp; vi_r2_3 &gt; 0)

## COV R-Sq

ma_model_4 &lt;- rma.mv(yi = covR_1, V = vi_r2_1, random = ~ 1 | dv_name/Refid, data = meta_r2_L2)
summary(ma_model_4)
## 
## Multivariate Meta-Analysis Model (k = 7; method: REML)
## 
##   logLik  Deviance       AIC       BIC      AICc   
##   6.9449  -13.8898   -7.8898   -8.5145    4.1102   
## 
## Variance Components:
## 
##             estim    sqrt  nlvls  fixed         factor 
## sigma^2.1  0.0012  0.0344      7     no        dv_name 
## sigma^2.2  0.0012  0.0344      7     no  dv_name/Refid 
## 
## Test for Heterogeneity:
## Q(df = 6) = 23.3892, p-val = 0.0007
## 
## Model Results:
## 
## estimate      se    zval    pval    ci.lb   ci.ub    
##   0.0484  0.0258  1.8765  0.0606  -0.0022  0.0990  . 
## 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

ma_model_5 &lt;- rma.mv(yi = covR_2, V = vi_r2_2, random = ~ 1 | dv_name/Refid, data = meta_r2_L3)
summary(ma_model_5)
## 
## Multivariate Meta-Analysis Model (k = 11; method: REML)
## 
##   logLik  Deviance       AIC       BIC      AICc   
##  -2.1801    4.3602   10.3602   11.2679   14.3602   
## 
## Variance Components:
## 
##             estim    sqrt  nlvls  fixed         factor 
## sigma^2.1  0.0418  0.2044     11     no        dv_name 
## sigma^2.2  0.0418  0.2044     11     no  dv_name/Refid 
## 
## Test for Heterogeneity:
## Q(df = 10) = 951.3831, p-val &lt; .0001
## 
## Model Results:
## 
## estimate      se    zval    pval   ci.lb   ci.ub      
##   0.3537  0.0960  3.6827  0.0002  0.1654  0.5419  *** 
## 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

#ma_model_6 &lt;- rma.mv(yi = covR_3, V = vi_r2_3, random = ~ 1 | dv_name/Refid, data = meta_r2_L4)
#summary(ma_model_6)

forest(ma_model_4, slab = paste(str_sub(meta_r2_L2$Author, 1, 10), str_sub(meta_r2_L2$dv_name, 1, 20), sep = &quot;, &quot;))
title(&quot;Covariate R-Squared, Level 2&quot;)
</code></pre>
<img src="https://example.com/2023-08-09-casper-meta-analysis/index.en_files/figure-html/unnamed-chunk-25-1.png" width="672" />
<pre><code class="language-r">
forest(ma_model_5, slab = paste(str_sub(meta_r2_L3$Author, 1, 10), str_sub(meta_r2_L3$dv_name, 1, 20), sep = &quot;, &quot;))
title(&quot;Covariate R-Squared, Level 3&quot;)
</code></pre>
<img src="https://example.com/2023-08-09-casper-meta-analysis/index.en_files/figure-html/unnamed-chunk-25-2.png" width="672" />
<pre><code class="language-r">
#forest(ma_model_6, slab = paste(str_sub(meta_r2_L3$Author, 1, 10), str_sub(meta_r2_L3$dv_name, 1, 20), sep = &quot;, &quot;))
#title(&quot;Covariate R-Squared, Level 4&quot;)
</code></pre>
<pre><code class="language-r">#d_meta &lt;- eff_ss_long %&gt;% select(Refid, Source_k, d_contrast, data_source:L3_ss, reg_coef, reg_coef_se, d_adj, duration, dtype:vi)
d_meta &lt;- eff_ss_long %&gt;% separate(col = Source_k, into = c(&quot;study&quot;, &quot;determinant&quot;, &quot;dv_name&quot;, &quot;dv_source&quot;), sep = &quot;\\|&quot;) %&gt;% select(-dv_source)

## Create a variable that identifies if the calculated d value aligns with the analysis conducted.
d_meta &lt;- d_meta %&gt;% select(-Author, -Title) %&gt;% mutate(d_tp = if_else(is.na(d_tp), 1, is.numeric(d_tp)),
                                                                       d_adj = if_else(is.na(d_adj), &quot;unadj&quot;, d_adj))

</code></pre>
<pre><code class="language-r">d_meta_wide &lt;- d_meta %&gt;% group_by(Refid, dv_name, d_adj, dtype) %&gt;% summarise(dval = mean(dval, na.rm = T)) %&gt;% pivot_wider(names_from = c(d_adj, dtype), values_from = dval) %&gt;% ungroup()
## `summarise()` has grouped output by 'Refid', 'dv_name', 'd_adj'. You can
## override using the `.groups` argument.

d_meta_wide &lt;- left_join(d_meta_wide, outcomes, c(&quot;Refid&quot;, &quot;dv_name&quot;))
d_meta_wide &lt;- left_join(d_meta_wide, metadata, &quot;Refid&quot;)
d_meta_wide &lt;- left_join(d_meta_wide, imp_strategies_wide, c(&quot;Refid&quot;, &quot;IVs_k&quot;))

#write.csv(d_meta_wide, &quot;d_meta_wide.csv&quot;, na=&quot;&quot;)
</code></pre>
<pre><code class="language-r"># Join study characteristics dataset with effect size dataset.
d_meta &lt;- left_join(d_meta, outcomes, c(&quot;Refid&quot;, &quot;dv_name&quot;))
d_meta &lt;- left_join(d_meta, metadata, &quot;Refid&quot;)
d_meta &lt;- left_join(d_meta, imp_strategies_wide, c(&quot;Refid&quot;, &quot;IVs_k&quot;))


d_meta_wide &lt;- d_meta %&gt;% group_by(dv_name, data_source, d_adj, d_contrast) %&gt;% slice(which.min(d_tp)) %&gt;% pivot_wider(names_from = c(data_source, d_adj, d_contrast, dtype), values_from = dval)

</code></pre>
<pre><code class="language-r">## Index the contrast metadata to the appropriate contrast.
d_meta &lt;- d_meta %&gt;% mutate(prim_name = if_else(d_contrast == &quot;1v2&quot; | d_contrast == &quot;1v3&quot; | d_contrast == &quot;1v4&quot;, name_1, 
                                                if_else(d_contrast == &quot;2v3&quot; | d_contrast == &quot;2v4&quot;, name_2, name_3)),
                            comparator_name = if_else(d_contrast == &quot;1v4&quot; | d_contrast == &quot;2v4&quot; | d_contrast == &quot;3v4&quot;, name_4, 
                                                if_else(d_contrast == &quot;1v3&quot; | d_contrast == &quot;2v3&quot;, name_3, name_2)), 
                            prim_eric = if_else(d_contrast == &quot;1v2&quot; | d_contrast == &quot;1v3&quot; | d_contrast == &quot;1v4&quot;, eric_1, 
                                                if_else(d_contrast == &quot;2v3&quot; | d_contrast == &quot;2v4&quot;, eric_2, eric_3)),
                            comparator_eric = if_else(d_contrast == &quot;1v4&quot; | d_contrast == &quot;2v4&quot; | d_contrast == &quot;3v4&quot;, eric_4, 
                                                if_else(d_contrast == &quot;1v3&quot; | d_contrast == &quot;2v3&quot;, eric_3, eric_2)),
                            prim_target1 = if_else(d_contrast == &quot;1v2&quot; | d_contrast == &quot;1v3&quot; | d_contrast == &quot;1v4&quot;, target1_1, 
                                                if_else(d_contrast == &quot;2v3&quot; | d_contrast == &quot;2v4&quot;, target1_2, target1_3)),
                            comparator_target1 = if_else(d_contrast == &quot;1v4&quot; | d_contrast == &quot;2v4&quot; | d_contrast == &quot;3v4&quot;, target1_4, 
                                                         if_else(d_contrast == &quot;1v3&quot; | d_contrast == &quot;2v3&quot;, target1_3, target1_2)),
                            prim_target2 = if_else(d_contrast == &quot;1v2&quot; | d_contrast == &quot;1v3&quot; | d_contrast == &quot;1v4&quot;, target2_1,
                                                   if_else(d_contrast == &quot;2v3&quot; | d_contrast == &quot;2v4&quot;, target2_2, target2_3)),
                            comparator_target2 = if_else(d_contrast == &quot;1v4&quot; | d_contrast == &quot;2v4&quot; | d_contrast == &quot;3v4&quot;, target2_4,
                                                         if_else(d_contrast == &quot;1v3&quot; | d_contrast == &quot;2v3&quot;, target2_3, target2_2))) %&gt;% select(Refid:rand_L4, prim_name:comparator_target2) 


# Take only d values with a variance, group by outcome and only take the first time point
# If the outcome is symptoms, flip the sign of the d value.
meta_d &lt;- d_meta %&gt;% filter(dval &lt; 3 &amp; dval &gt; -1) %&gt;% group_by(dv_name, d_contrast) %&gt;% slice(which.min(d_tp)) %&gt;% mutate(dval = if_else(dv_outcome == &quot;symptoms&quot;, dval*-1, dval))

</code></pre>
<pre><code class="language-r"># Subtract implementation strategies from each other.
meta_d &lt;- meta_d %&gt;%
    mutate(
        prim_subtracted = map2(
            str_split(prim_eric, &quot;,&quot;),
            str_split(comparator_eric, &quot;,&quot;),
            ~ setdiff(.x, .y)
        ) %&gt;% map_chr(~ paste0(.x, collapse = &quot;;&quot;)) %&gt;% str_trim(),
        comparator_subtracted = map2(
            str_split(comparator_eric, &quot;,&quot;),
            str_split(prim_eric, &quot;,&quot;),
            ~ setdiff(.x, .y)
        ) %&gt;% map_chr(~ paste0(.x, collapse = &quot;;&quot;)) %&gt;% str_trim(),
        comparator_subtracted = if_else(comparator_subtracted == &quot;NA&quot;, &quot;Service as usual&quot;, comparator_subtracted),
        effect_size_type = if_else(comparator_subtracted == &quot;Service as usual&quot;, &quot;Service as usual&quot;,
                                   if_else(comparator_subtracted == &quot;&quot;, &quot;Enhanced vs. Standard&quot;, &quot;Comparative Effectiveness&quot;))
    )
# Split apart datasets into 3 distinct analytical datasets.

# Make paper dataset, we have 3 different types of &quot;paper&quot; d-values (t-test, p-value directly reported) for now I just took the minimum.
meta_d_paper &lt;- meta_d %&gt;% filter(data_source == &quot;Paper&quot;) %&gt;% group_by(dv_name, d_contrast) %&gt;% slice(which.min(d_tp))
meta_d_service_as_usual &lt;- meta_d %&gt;% filter(effect_size_type == &quot;Service as usual&quot; &amp; !is.na(vi))
meta_d_enhancedvstandard &lt;- meta_d %&gt;% filter(effect_size_type == &quot;Enhanced vs. Standard&quot; &amp; !is.na(vi))
meta_d_compeff &lt;- meta_d %&gt;% filter(effect_size_type == &quot;Comparative Effectiveness&quot; &amp; !is.na(vi))
</code></pre>
<h3 id="visualize-effect-size-estiamte">Visualize Effect Size Estiamte</h3>
<pre><code class="language-r"># PLOT FOREST PLOT OF d values from PAPER
library(ggh4x) #https://cjvanlissa.github.io/Doing-Meta-Analysis-in-R/robust-variance-estimation-1.html
meta_d_paper %&gt;% ggplot(aes(x = dval, y = interaction(str_sub(dv_name, 1, 15), dv_outcome, str_sub(Author, 1, 8)))) + geom_point(shape = &quot;square&quot;) + geom_vline(aes(xintercept = 0), alpha = 0.5) + scale_y_discrete(guide = &quot;axis_nested&quot;)
</code></pre>
<img src="https://example.com/2023-08-09-casper-meta-analysis/index.en_files/figure-html/unnamed-chunk-31-1.png" width="672" />
<h2 id="strategy-vs-service-as-usual">Strategy vs. Service as usual</h2>
<pre><code class="language-r">
# Should we use robust variance estimation: https://www.tandfonline.com/doi/abs/10.1080/13645579.2016.1252189

ma_model_1 &lt;- rma.mv(yi = dval, vi, random = ~ 1 | dv_name/Refid, data = meta_d_service_as_usual)
summary(ma_model_1)
## 
## Multivariate Meta-Analysis Model (k = 8; method: REML)
## 
##   logLik  Deviance       AIC       BIC      AICc   
##  -6.6535   13.3069   19.3069   19.1446   27.3069   
## 
## Variance Components:
## 
##             estim    sqrt  nlvls  fixed         factor 
## sigma^2.1  0.0196  0.1401      8     no        dv_name 
## sigma^2.2  0.0196  0.1401      8     no  dv_name/Refid 
## 
## Test for Heterogeneity:
## Q(df = 7) = 19.4415, p-val = 0.0069
## 
## Model Results:
## 
## estimate      se    zval    pval   ci.lb   ci.ub      
##   0.5566  0.1110  5.0160  &lt;.0001  0.3391  0.7740  *** 
## 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

forest(ma_model_1, slab = paste(str_sub(meta_d_service_as_usual$Author, 1, 10), str_sub(meta_d_service_as_usual$prim_name, 1, 10), str_sub(meta_d_service_as_usual$dv_name, 1, 20)))
title(&quot;Effect Size: Strategy vs. Service as usual&quot;)
</code></pre>
<img src="https://example.com/2023-08-09-casper-meta-analysis/index.en_files/figure-html/unnamed-chunk-32-1.png" width="672" />
<pre><code class="language-r">
funnel(ma_model_1)
</code></pre>
<img src="https://example.com/2023-08-09-casper-meta-analysis/index.en_files/figure-html/unnamed-chunk-32-2.png" width="672" />
<pre><code class="language-r">
clubSandwich::coef_test(ma_model_1, vcov = &quot;CR2&quot;) # RVE using method from Tipton and Pustejovsky (2015)
##    Coef. Estimate    SE t-stat d.f. (Satt) p-val (Satt) Sig.
##  intrcpt    0.557 0.111      5        4.24      0.00645   **
</code></pre>
<h2 id="enhanced-implementation-strategy-vs-standard-implementation-strategy">Enhanced Implementation Strategy vs. Standard Implementation Strategy:</h2>
<pre><code class="language-r">ma_model_2 &lt;- rma.mv(yi = dval, vi, random = ~ 1 | dv_name/Refid, data = meta_d_enhancedvstandard)
summary(ma_model_2)
## 
## Multivariate Meta-Analysis Model (k = 11; method: REML)
## 
##   logLik  Deviance       AIC       BIC      AICc   
## -10.8701   21.7401   27.7401   28.6479   31.7401   
## 
## Variance Components:
## 
##             estim    sqrt  nlvls  fixed         factor 
## sigma^2.1  0.2298  0.4794     11     no        dv_name 
## sigma^2.2  0.2298  0.4794     11     no  dv_name/Refid 
## 
## Test for Heterogeneity:
## Q(df = 10) = 146.6944, p-val &lt; .0001
## 
## Model Results:
## 
## estimate      se    zval    pval    ci.lb   ci.ub    
##   0.2863  0.2260  1.2668  0.2052  -0.1566  0.7292    
## 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

forest(ma_model_2, slab = paste(str_sub(meta_d_enhancedvstandard$Author, 1, 10), str_sub(meta_d_enhancedvstandard$prim_name, 1, 10), str_sub(meta_d_enhancedvstandard$dv_name, 1, 20)))
title(&quot;Effect Size: Enhanced Strategy vs. Stategy&quot;)
</code></pre>
<img src="https://example.com/2023-08-09-casper-meta-analysis/index.en_files/figure-html/unnamed-chunk-33-1.png" width="672" />
<pre><code class="language-r">
funnel(ma_model_2)
</code></pre>
<img src="https://example.com/2023-08-09-casper-meta-analysis/index.en_files/figure-html/unnamed-chunk-33-2.png" width="672" />
<pre><code class="language-r">
clubSandwich::coef_test(ma_model_2, vcov = &quot;CR2&quot;) # RVE using method from Tipton and Pustejovsky (2015)
##    Coef. Estimate    SE t-stat d.f. (Satt) p-val (Satt) Sig.
##  intrcpt    0.286 0.227   1.26        9.89        0.236
</code></pre>
<h2 id="comparative-effectiveness">Comparative Effectiveness:</h2>
<pre><code class="language-r">ma_model_3 &lt;- rma.mv(yi = dval, vi, random = ~ 1 | dv_name/Refid, data = meta_d_compeff)
summary(ma_model_3)
## 
## Multivariate Meta-Analysis Model (k = 4; method: REML)
## 
##   logLik  Deviance       AIC       BIC      AICc   
##   0.5190   -1.0381    4.9619    2.2578   28.9619   
## 
## Variance Components:
## 
##             estim    sqrt  nlvls  fixed         factor 
## sigma^2.1  0.0006  0.0243      4     no        dv_name 
## sigma^2.2  0.0006  0.0243      4     no  dv_name/Refid 
## 
## Test for Heterogeneity:
## Q(df = 3) = 2.2185, p-val = 0.5283
## 
## Model Results:
## 
## estimate      se    zval    pval   ci.lb   ci.ub    
##   0.1704  0.0681  2.5014  0.0124  0.0369  0.3039  * 
## 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

forest(ma_model_3, cex=0.9, header=TRUE, top=2, slab = paste(str_sub(meta_d_compeff$Author, 1, 10), str_sub(meta_d_compeff$prim_name, 1, 10), str_sub(meta_d_compeff$comparator_name, 1, 10), str_sub(meta_d_compeff$dv_name, 1, 20)))
title(&quot;Effect Size: Comparative Effectiveness&quot;)
</code></pre>
<img src="https://example.com/2023-08-09-casper-meta-analysis/index.en_files/figure-html/unnamed-chunk-34-1.png" width="672" />
<pre><code class="language-r">
funnel(ma_model_3)
</code></pre>
<img src="https://example.com/2023-08-09-casper-meta-analysis/index.en_files/figure-html/unnamed-chunk-34-2.png" width="672" />
<pre><code class="language-r"> 
clubSandwich::coef_test(ma_model_3, vcov = &quot;CR2&quot;)# RVE using method from Tipton and Pustejovsky (2015)
##    Coef. Estimate    SE t-stat d.f. (Satt) p-val (Satt) Sig.
##  intrcpt     0.17 0.067   2.54        1.21        0.202
</code></pre>

  </main>
  <div id="disqus-container">
  
    <button id="disqus-button" onclick="showComments()">Show comments</button>
    <div id="disqus-comments">
      
      
      
        <p><em>Disqus comments are disabled.</em></p>
        <script type="application/javascript">
          function showComments() {
            // Remove button
var disqusButton = document.getElementById('disqus-button');
disqusButton.parentNode.removeChild(disqusButton); 
// Un-hide comments
var disqusComments = document.getElementById('disqus-comments');
disqusComments.style.display = 'block'; 
          }
        </script>
      
      <noscript>Enable JavaScript to view Disqus comments.</noscript>
    </div>
  
</div>

  
<script src="https://utteranc.es/client.js"
        repo="nickcardamone/CASPER"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<style>
    .utterances-frame {
        background-color: transparent;
    }
</style>
<script>
    function changeTheme(theme) {
        const message = {
            type: "set-theme",
            theme
        };
        const utteranc = document.querySelector(".utterances-frame");
        utteranc.contentWindow.postMessage(message, "https://utteranc.es");
    }

    document.onreadystatechange = () => {
        if (document.readyState === "complete") {
            
            if (!document.getElementById("darkTheme").disabled) {
                changeTheme("photon-dark");
            }
            
            document.getElementById("themer").addEventListener("click", () => {
                changeTheme(document.getElementById("darkTheme").disabled ? "photon-dark" : "github-light");
            });
        }
    };
</script>
<noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by
    utterances.</a></noscript>


          
            <footer role="contentinfo">
  <div
  
  >
    <label for="themer">
      dark theme: <input type="checkbox" id="themer" class="vh">
      
      <span aria-hidden="true"></span>
    </label>
  </div>
  
    Made with <a href="https://gohugo.io/">Hugo</a>. Themed by <a href="https://github.com/zwbetz-gh/cupper-hugo-theme">Cupper</a>. Deployed to <a href="https://www.netlify.com/">Netlify</a>.
  
</footer>

          
        </div>
      </div>
    </div>
    

<script src="/js/dom-scripts.js"></script>  

<script src="/js/prism.js"></script>



<script src="/js/search.7aef046a0cc8b0c532f1d20087b920459bc868c936bb48a6ae221eceefca2d07.js"></script>

<link rel="stylesheet" href="/css/search.fe0cd54a21628574bff49d721c827d1bb165ab56b0f22dd55ae78addbe61c309.css"></link>



  <script src="/js/custom_01.js"></script>

  <script src="/js/custom_02.js"></script>


    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css" integrity="sha384-dbVIfZGuN1Yq7/1Ocstc1lUEm+AT+/rCkibIcC/OmWo5f0EA48Vf8CytHzGrSwbQ" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js" integrity="sha384-2BKqo+exmr9su6dir+qCw08N2ZKRucY4PrGQPPWU1A7FtlCGjmEGFqXCv5nyM5Ij" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>

    
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  </body>
</html>
